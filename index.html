<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S.O.S Celulares - Celulares Novos e Seminovos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    .modal { display: none; }
    .modal.active { display: flex; }
    #mobileMenu { display: none; }
    #mobileMenu.show { display: block; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- Header -->
  <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">S.O.S Celulares</h1>
    <button id="menuToggle" class="md:hidden text-2xl"><i class="fas fa-bars"></i></button>
    <nav class="hidden md:flex gap-4">
      <a href="#" class="hover:underline">In√≠cio</a>
      <a href="#" class="hover:underline">Produtos</a>
      <a href="#" class="hover:underline">Contato</a>
    </nav>
  </header>

  <!-- Menu Mobile -->
  <nav id="mobileMenu" class="bg-blue-500 text-white p-4 md:hidden">
    <a href="#" class="block py-2">In√≠cio</a>
    <a href="#" class="block py-2">Produtos</a>
    <a href="#" class="block py-2">Contato</a>
  </nav>

  <!-- Produtos -->
  <main class="p-4">
    <h2 class="text-2xl font-bold mb-4">Celulares em Destaque</h2>
    <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
  </main>

  <!-- Modal -->
  <div id="modalOverlay" class="modal fixed inset-0 bg-black/50 justify-center items-center z-50">
    <div id="productModal" class="bg-white rounded-lg shadow-lg p-6 relative max-w-lg w-full"></div>
  </div>

  <script>
    let products = [];

    // Menu mobile
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    menuToggle.addEventListener('click', ()=> mobileMenu.classList.toggle('show'));

    // Carregar produtos JSON
    fetch("produtos.json")
      .then(res => res.json())
      .then(data => {
        products = data;
        renderProducts();
      });

    // Renderizar cards
    function renderProducts() {
      const grid = document.getElementById("productGrid");
      grid.innerHTML = "";

      products.forEach(p => {
        const card = document.createElement("div");
        card.className = "bg-white rounded-lg shadow p-4 flex flex-col";

        card.innerHTML = `
          <img src="${p.images[0]}" alt="${p.name}" class="h-40 object-contain mb-2 mx-auto">
          <h3 class="text-lg font-bold mb-1">${p.name}</h3>
          <p class="text-sm mb-2">${p.description}</p>
          ${p.variants ? `
            <select id="variantSelect${p.id}" class="border rounded px-2 py-1 mb-2">
              ${p.variants.map((v, i)=> `<option value="${i}">${v.name}</option>`).join("")}
            </select>
          ` : ""}
          <p class="text-blue-600 font-bold mb-2 priceArea"></p>
          <div class="specsContainer text-sm mb-2"></div>
          <button class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 mt-auto verProdutoBtn">Ver produto</button>
        `;

        grid.appendChild(card);

        const priceEl = card.querySelector(".priceArea");
        const specsEl = card.querySelector(".specsContainer");

        function updateVariant(variant) {
          priceEl.innerHTML = `√Ä vista: ${variant.price.avista}${
            variant.price.parcelado ? ` / Parcelado: ${variant.price.parcelado}` : ''
          }`;

          specsEl.innerHTML = variant.specs 
            ? `<strong>Especifica√ß√µes:</strong><ul class="list-disc ml-5">${variant.specs.map(s => `<li>${s}</li>`).join('')}</ul>`
            : '';
        }

        if (p.variants) {
          const select = card.querySelector(`#variantSelect${p.id}`);
          updateVariant(p.variants[0]);
          select.addEventListener("change", (e) => {
            updateVariant(p.variants[e.target.value]);
          });
        } else {
          priceEl.textContent = typeof p.price === "object"
            ? `√Ä vista: ${p.price.avista}${p.price.parcelado ? ` / Parcelado: ${p.price.parcelado}` : ''}`
            : p.price;

          specsEl.innerHTML = p.specs 
            ? `<strong>Especifica√ß√µes:</strong><ul class="list-disc ml-5">${p.specs.map(s => `<li>${s}</li>`).join('')}</ul>`
            : '';
        }

        // Abrir modal
        card.querySelector(".verProdutoBtn").addEventListener("click", () => openProductModal(p));
      });
    }

    // Modal
    const modal = document.getElementById('productModal');
    const modalOverlay = document.getElementById('modalOverlay');
    const modalContent = document.getElementById('productModal');

    function openProductModal(product) {
      let currentImageIndex = 0;

      let variantSelectHtml = '';
      if (product.variants) {
        variantSelectHtml = `
          <label class="block mb-1 font-bold">Armazenamento:</label>
          <select class="w-full border rounded px-2 py-1 mb-2" id="modalVariantSelect">
            ${product.variants.map((v, i) => `<option value="${i}">${v.name}</option>`).join('')}
          </select>
        `;
      }

      modalContent.innerHTML = `
        <button id="closeModal" class="absolute top-2 right-2 text-gray-600 text-2xl font-bold hover:text-gray-800">&times;</button>
        <h2 class="text-2xl font-bold mb-4">${product.name}</h2>
        <div class="relative mb-4">
          <img id="modalProductImage" src="${product.images[0]}" alt="${product.name}" class="w-full rounded"/>
          ${product.images.length > 1 ? `
            <button id="prevImage" class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-white/70 px-2 py-1 rounded hover:bg-white">‚Äπ</button>
            <button id="nextImage" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-white/70 px-2 py-1 rounded hover:bg-white">‚Ä∫</button>
          ` : ''}
        </div>
        <p class="mb-2">${product.description}</p>
        ${variantSelectHtml}
        <div id="specsContainer" class="mb-2"></div>
        <p id="variationPrice" class="text-xl font-bold text-blue-600"></p>
        <div class="mb-4">
          <label for="customerName" class="block font-bold mb-1">Seu nome:</label>
          <input type="text" id="customerName" class="w-full border rounded px-3 py-2" placeholder="Digite seu nome">
        </div>
        <button id="whatsappBtn" class="mt-2 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Comprar via WhatsApp</button>
      `;

      // Galeria autom√°tica
      const modalImage = document.getElementById('modalProductImage');
      let imageInterval = setInterval(() => {
        currentImageIndex = (currentImageIndex + 1) % product.images.length;
        modalImage.src = product.images[currentImageIndex];
      }, 3000);

      const prevBtn = document.getElementById('prevImage');
      const nextBtn = document.getElementById('nextImage');
      if (prevBtn && nextBtn) {
        prevBtn.addEventListener('click', () => {
          currentImageIndex = (currentImageIndex - 1 + product.images.length) % product.images.length;
          modalImage.src = product.images[currentImageIndex];
        });
        nextBtn.addEventListener('click', () => {
          currentImageIndex = (currentImageIndex + 1) % product.images.length;
          modalImage.src = product.images[currentImageIndex];
        });
      }

      // Atualiza√ß√£o pre√ßo/specs
      const priceEl = document.getElementById("variationPrice");
      const specsEl = document.getElementById("specsContainer");

      function updateVariant(variant) {
        priceEl.innerHTML = `√Ä vista: ${variant.price.avista}${
          variant.price.parcelado ? ` / Parcelado: ${variant.price.parcelado}` : ''
        }`;
        specsEl.innerHTML = variant.specs 
          ? `<strong>Especifica√ß√µes:</strong><ul class="list-disc ml-5">${variant.specs.map(s => `<li>${s}</li>`).join('')}</ul>`
          : '';
      }

      if (product.variants) {
        const select = document.getElementById("modalVariantSelect");
        updateVariant(product.variants[0]);
        select.addEventListener("change", (e) => {
          updateVariant(product.variants[e.target.value]);
        });
      } else {
        priceEl.textContent = typeof product.price === "object"
          ? `√Ä vista: ${product.price.avista}${product.price.parcelado ? ` / Parcelado: ${product.price.parcelado}` : ''}`
          : product.price;
        specsEl.innerHTML = product.specs 
          ? `<strong>Especifica√ß√µes:</strong><ul class="list-disc ml-5">${product.specs.map(s => `<li>${s}</li>`).join('')}</ul>`
          : '';
      }

      // WhatsApp
      document.getElementById('whatsappBtn').addEventListener('click', () => {
        const nameInput = document.getElementById('customerName').value.trim();
        const name = nameInput ? nameInput : "Cliente";
        let priceText = priceEl.textContent;
        let variantText = '';
        if (product.variants) {
          const select = document.getElementById("modalVariantSelect");
          const chosen = product.variants[select.value];
          variantText = `üì¶ Vers√£o: ${chosen.name}\n`;
        }
        const msg = encodeURIComponent(
          `Ol√°, meu nome √© ${name}.\nEstou entrando em contato pelo site da S.O.S Celulares.\nTenho interesse no seguinte produto:\nüì± Produto: ${product.name}\n${variantText}üí∞ Pre√ßo: ${priceText}\nGostaria de receber mais informa√ß√µes e verificar disponibilidade.`
        );
        window.open(`https://wa.me/5564999518536?text=${msg}`, '_blank');
      });

      // Fechar modal
      document.getElementById('closeModal').addEventListener('click', () => { 
        modalOverlay.classList.remove('active'); 
        clearInterval(imageInterval);
      });
      modalOverlay.addEventListener('click', (e) => { 
        if (e.target === modalOverlay) {
          modalOverlay.classList.remove('active'); 
          clearInterval(imageInterval);
        }
      });

      modalOverlay.classList.add('active');
    }
  </script>
</body>
</html>
